# 4x4 压力传感器阵列可视化分析文档

## 1. 传感器工作原理概述

该系统使用的压力传感器是一个 4x4 的阵列，通过行列交叉检测的方式引出 8 根数据线：4 根行信号线和 4 根列信号线。当阵列中的某个点被触碰时，对应的行信号线和列信号线会同时产生一个信号。通过检测哪根行线和哪根列线有信号，可以确定被触碰点的精确位置（寻址）。

**重要限制：** 由于多点触摸可能导致“鬼点”问题，目前的系统设计仅支持单点触摸，即在任何时刻，只有阵列中的一个点被触碰。这意味着在接收到的数据中，只会有一根行信号线和一根列信号线同时有显著的信号输出。

## 2. 当前程序的数据处理方式

根据对 `UpperComputer.py` 代码的分析，程序当前接收并处理来自串口的 8 路数据信号。这些信号被用于绘制 8 个独立的电压-时间曲线图（对应 8 个通道）。程序通过 `SerialManager` 接收原始数据，然后由 `PlotManager` 进行处理和可视化。

目前的数据处理主要集中在将接收到的原始数据转换为电压值，并将其添加到对应通道的数据队列中，然后更新图表显示。程序能够实时显示每个通道的信号变化，但没有将这 8 路信号关联起来以确定具体的触摸点。

## 3. 可视化目标

目标是在上位机界面上添加一个 4x4 的像素映射区域，直观地显示压力传感器阵列上哪个点被触碰。当某个点被触碰时，映射区域中对应的“像素”或单元格应该以某种方式高亮显示，以指示触摸位置。

## 4. 实现思路

要实现 4x4 像素映射的可视化，需要以下几个步骤：

### 4.1. 数据解析与触摸点判断

- **接收 8 路信号：** 程序已经能够接收 8 路信号。
- **判断触摸点：** 在接收到新的 8 路信号数据后，需要分析这 8 个值。由于是单点触摸，理论上只有一对（一行一列）信号会显著高于背景噪声。需要设定一个阈值，判断哪些信号是“激活”的。
- **确定行列索引：** 根据激活的行信号线和列信号线，确定被触碰点的行索引（0-3）和列索引（0-3）。例如，如果第 2 行信号线和第 3 列信号线同时激活，则触摸点为 (1, 2)（使用零基索引）。
- **处理无触摸或多点触摸（异常情况）：** 如果没有信号超过阈值（无触摸），或者有多于一对的信号超过阈值（多点触摸，尽管系统设计上应避免），程序需要能够识别这种情况，并可能在界面上显示“无触摸”或“异常”状态。

### 4.2. 界面设计与实现

- **添加新的UI组件：** 在主窗口布局中添加一个新的区域，用于显示 4x4 的像素映射。可以使用 `QGridLayout` 或嵌套的 `QVBoxLayout` 和 `QHBoxLayout` 来构建 4x4 的网格。
- **表示像素/单元格：** 网格中的每个单元格可以是一个 `QLabel` 或一个自定义的 `QWidget`，用于表示传感器阵列中的一个点。
- **可视化高亮：** 当确定触摸点后，修改对应单元格的背景颜色、边框或其他视觉属性，使其高亮显示。

### 4.3. 数据流与更新机制

- **集成到数据处理流程：** 将触摸点判断逻辑集成到 `PlotManager` 或一个新的数据处理模块中。
- **信号与槽连接：** 当检测到触摸点变化时，发射一个信号，连接到更新 4x4 映射界面的槽函数。
- **实时更新：** 确保映射界面能够根据接收到的最新数据实时更新。

## 5. 代码修改计划

1.  **创建新的UI组件：** 在 `ui_components.py` 中添加一个函数，用于创建 4x4 像素映射的QWidget，并返回该QWidget及其内部的单元格（例如，一个二维列表的QLabel）。
2.  **集成到主窗口：** 在 `MainWindow._init_ui` 方法中调用新创建的函数，并将返回的QWidget添加到主布局中。将单元格的引用保存为 `MainWindow` 的成员变量。
3.  **修改数据处理逻辑：** 在 `PlotManager` 的 `update_plots` 方法（或创建一个新的方法）中，在更新图表数据之后，添加触摸点判断逻辑。
4.  **添加信号：** 在 `PlotManager` 中定义一个新的 `pyqtSignal`，用于发送检测到的触摸点信息（例如，行索引和列索引）。
5.  **连接信号与槽：** 在 `MainWindow.__init__` 中，连接 `PlotManager` 发射的触摸点信号到 `MainWindow` 中用于更新 4x4 映射界面的槽函数。
6.  **实现更新槽函数：** 在 `MainWindow` 中实现槽函数，根据接收到的触摸点信息，更新对应单元格的显示状态。
7.  **考虑阈值设定：** 可能需要一个方法来动态或静态地设定判断信号激活的阈值。

通过以上步骤，可以在现有程序的基础上增加 4x4 像素映射的可视化功能。